---
type: assignment
date: 2025-07-01T04:00:00+04:30
title: "Homework #4"
pdf: /static_files/assignments/HW4_CN_fMRI_HandsOn.zip
due_event: 
  type: due
  description: "Assignment #4 due" 
---
**All necessary files for this assignment are available [here](...)
This work outlines the big picture of fMRI, using Python to navigate from pre-processing anatomical images to defining ROIs, building GLM models, and exploring the brain's dynamic networks through functional connectivity.

fMRI Data Analysis Hands-on Assignment: From Event Matrix to Layer-Specific LGN Activation
1. Introduction
1.1. Objective
This hands-on assignment guides students through the foundational stages of fMRI data analysis. The primary goal is to process T1 and fMRI data, construct an event matrix based on a visual stimulation paradigm, build a design matrix, fit a General Linear Model (GLM), and ultimately visualize the results through statistical contrasts and Z-score mapping to identify lateral geniculate nucleus (LGN) activation.
1.2. Assignment Structure
The exercise is systematically divided into six main tasks. Clicking on each section navigates the user to the corresponding instructions. The process begins with data loading and preliminary visualization, proceeds through the core stages of GLM analysis, and culminates in a bonus exercise for advanced layer-specific differentiation within the LGN.
2. Theoretical Background & Experimental Paradigm
2.1. Visual Stimulation Paradigm
The visual stimulus alternates between the left and right visual fields in a block design. Each block lasts for 13 seconds. This alternating stimulation is designed to selectively activate the contralateral LGN. For instance, stimulation of the left visual field primarily activates the right LGN and vice versa. This contralateral organization forms the basis for localizing the LGN in the thalamus.
2.2. From Events to Hemodynamic Response
The core of fMRI analysis involves modeling the relationship between external stimuli and the measured BOLD signal. This is achieved by convolving the timing of experimental events (Event Matrix) with a model of the hemodynamic response function (HRF) to create a predictive model (Design Matrix) used in the GLM.
3. Data Description & Preprocessing
3.1. Data Specifications
The provided fMRI dataset has the following characteristics, as detailed in its header:
•	Voxel Size: 1.8 × 1.8 × 1.8 mm
•	Data Shape: 122 × 122 × 22 × 120
o	The first three dimensions (122, 122, 22) represent the spatial resolution.
o	The fourth dimension (120) is the number of timepoints (volumes) in the time series.
•	Repetition Time (TR): 2.5 seconds. This means a full brain volume was acquired every 2.5 seconds, resulting in a total acquisition time of 120 volumes × 2.5 s/volume = 300 seconds (5 minutes).
3.2. Data Loading and Initialization
Data loading is performed using the Nibabel library in Python. The load function is used to read the data file, and the get_fdata() method is called to extract the numerical image data array from the header for further processing.
3.3. Preliminary Data Visualization
As an initial step, students are required to extract and visualize the middle slice of the T1 anatomical data in the axial plane. This is accomplished using libraries such as Matplotlib and plt.imshow to display the image, providing a preliminary familiarity with the data structure.
4. Core GLM Analysis Pipeline
4.1. Task 1: Constructing the Event Matrix
The Event Matrix defines the timing and type of events during the fMRI scan. It is structured as a DataFrame with the following essential columns:
•	Onset: The start time of each event in seconds relative to the beginning of the scan. The first stimulus occurs at 8.25 seconds, following an initial 8-second rest period.
•	Duration: The length of each event block (13 seconds).
•	Trial Type: A coded value indicating the event type.
o	0: Rest / No stimulus
o	1: Left visual field stimulus
o	2: Right visual field stimulus
The stimulus follows a repeating sequence: 13 seconds left, 13 seconds right, starting from 8.25 seconds. The logic for building the matrix involves iterating through the total scan time, incrementing the current time by the block_duration (13 seconds), and assigning the correct trial_type in an alternating pattern (1, 2, 1, 2...).
4.2. Task 2: Creating the Design Matrix
The Design Matrix is a convolved version of the Event Matrix. It is generated by convolving the event timing with a canonical Hemodynamic Response Function (HRF) and its derivatives (optional). Using Nilearn, different HRF models (e.g., 'glover', 'spm') and drift models can be compared. The final Design Matrix includes columns for each condition's predicted BOLD response, potential derivatives, and constant terms.
4.3. Task 3: GLM Model Fitting
The constructed Design Matrix and the preprocessed fMRI data are fed into a GLM implemented in Nilearn. Confound regressors, which account for subject head motion during the scan (e.g., 6 motion parameters), are also included in the model to improve the specificity of the activation estimates. It is recommended to run the GLM both with and without confounds to observe their impact on the results.
4.4. Task 4: Defining and Computing Contrasts
Contrasts are defined to statistically compare conditions. To isolate the differential activation of the LGN, two opposing contrasts are created:
•	Left vs. Right (L > R): Assigns a value of +1 to columns for the left stimulus and -1 to columns for the right stimulus. All other columns (e.g., rest, confounds) are set to 0.
•	Right vs. Left (R > L): Assigns a value of +1 to columns for the right stimulus and -1 to columns for the left stimulus.
This contrast mechanism highlights voxels that are more active in one condition compared to the other, effectively canceling out shared activation.
4.5. Task 5: Visualization of Results
The computed contrast maps are converted to Z-scores for statistical interpretation. These Z-score maps are then overlaid onto the anatomical T1-weighted background image for visualization. To specifically highlight the LGN, an anatomical mask of the LGN can be applied, which filters out activations in other brain regions, resulting in a clean and precise visualization of the target structure.
5. Advanced Exercise: Layer-Specific LGN Analysis
5.1. Objective
This bonus section extends the core analysis to differentiate responses from the Magnocellular and Parvocellular layers within the LGN using a more complex stimulation paradigm.
5.2. Paradigm and Event Matrix
A new Event Matrix must be constructed for a paradigm with the following sequence:
•	25 seconds Rest
•	25 seconds Canio stimulus
•	25 seconds Magno stimulus
•	25 seconds Parvo stimulus
5.3. Contrasts for Layer Differentiation
For each hemisphere, a set of three contrasts should be computed to dissociate layer-specific responses:
•	Canio vs. Magno
•	Canio vs. Parvo
•	Magno vs. Parvo

This results in a total of six distinct contrast maps (three for each hemisphere), providing a detailed analysis of the functional organization within the LGN.

